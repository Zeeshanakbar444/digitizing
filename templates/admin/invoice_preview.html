<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Preview - {{invoice_data.invoice_number}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa; /* Ensure a consistent light background */
        }
        .invoice-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 8px; /* Slightly rounded corners for a modern look */
            overflow: hidden; /* Ensures shadow and border-radius apply correctly */
        }
        .company-logo {
            font-size: 2rem;
            font-weight: bold;
            color: #17a2b8;
        }
        /* Base styles for stamps - centered horizontally by default */
        .unpaid-stamp,
        .paid-stamp {
            position: absolute;
            top: 118px; /* Default top for larger screens */
            left: 50%; /* Center horizontally */
            transform: translateX(-50%) rotate(339deg); /* Apply centering transform and original rotation */
            background: #dc3545; /* Unpaid color */
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            white-space: nowrap; /* Prevent text from wrapping */
            z-index: 10; /* Ensure stamp is above other content */
        }
        .paid-stamp {
            background: #6adc35; /* Paid color */
        }
        .company-logo img {
            width: 214px; /* Default logo width */
            height: auto;
        }
        @media print {
            .no-print {
                display: none !important;
            }
        }

        /* Responsive adjustments */

        /* For Medium devices (tablets, 768px and up) */
        @media (max-width: 991.98px) {
            .invoice-container {
                padding: 25px !important; /* Slightly reduce padding from default 30px */
            }
            .unpaid-stamp,
            .paid-stamp {
                top: 90px; /* Adjust top for tablets */
                font-size: 1.1rem;
                padding: 9px 18px;
            }
        }

        /* For Small devices (landscape phones, 576px and up, and smaller tablets) */
        @media (max-width: 767.98px) {
            .invoice-container {
                padding: 15px !important; /* Further reduce padding for smaller screens */
            }
            .unpaid-stamp,
            .paid-stamp {
                top: 37%; /* Adjust top for phones/small tablets */
                font-size: 0.9rem;
                padding: 8px 15px;
            }
            /* Adjust text alignment for invoice details in header when columns stack */
            .invoice-container .row.mb-4 > div:last-child {
                text-align: start !important; /* Override Bootstrap's text-end for better mobile readability */
                margin-top: 1rem; /* Add space between logo and invoice details when stacked */
            }
            /* Make action buttons stack vertically on smaller screens */
            .no-print .d-flex {
                flex-direction: column; /* Stack items vertically */
                align-items: stretch !important; /* Make children stretch to full width */
            }
            .no-print .d-flex > a, /* Target the 'Back to Create Invoice' button */
            .no-print .d-flex > div { /* Target the div containing 'Download PDF' button */
                width: 100%; /* Make them take full width */
                margin-bottom: 10px; /* Add vertical spacing between stacked items */
            }
            .no-print .d-flex > div .btn { /* Ensure the download button inside its div also takes full width */
                width: 100%;
            }
            .no-print .d-flex > div:last-child {
                margin-bottom: 0; /* No margin after the last item */
            }
            /* Adjust font sizes for better fit on smaller screens */
            .invoice-container h2 {
                font-size: 1.8rem;
            }
            .invoice-container h5 {
                font-size: 1.1rem;
            }
            .invoice-container p {
                font-size: 0.9rem;
            }
            .table th, .table td {
                font-size: 0.85rem; /* Slightly smaller table text */
            }
        }

        /* For Extra small devices (portrait phones, less than 576px) */
        @media (max-width: 575.98px) {
            .company-logo img {
                width: 120px; /* Make logo slightly smaller on very small screens */
            }
            .unpaid-stamp,
            .paid-stamp {
                top: 37%; /* Further adjust top for very small screens */
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            .invoice-container h2 {
                font-size: 1.5rem; /* Even smaller invoice title */
            }
            .invoice-container h5 {
                font-size: 1rem; /* Even smaller customer name */
            }
            .invoice-container p {
                font-size: 0.85rem; /* Even smaller paragraph text */
            }
            .table th, .table td {
                font-size: 0.8rem; /* Smallest table text */
            }
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <!-- Action Buttons -->
        <div class="row mb-4 no-print">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    {% if request.user.is_superuser %}
                    <a href="{% url 'create_invoice' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Back to Create Invoice
                    </a>
                    {% endif %}
                    <div>
                        <!-- <button onclick="window.print()" class="btn btn-primary me-2">
                            <i class="bi bi-printer me-2"></i>Print
                        </button> -->
                        <a href="/download-invoice-pdf/{{invoice_data.invoice_id}}" class="btn btn-success">
                            <i class="bi bi-download me-2"></i>Download PDF
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Invoice -->
        <div class="invoice-container p-4 position-relative">
            <!-- Unpaid Stamp -->
            {% if invoice_data.status == 'UNPAID' %}
            <div class="unpaid-stamp">{{invoice_data.status}}</div>
            {% elif invoice_data.status == 'PAID' %}
            <div class="paid-stamp">{{invoice_data.status}}</div>
            {% endif %}
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-md-6 col-12"> <!-- Use col-md-6 to ensure stacking on smaller screens -->
                    <div class="company-logo">
                        <img src="/static/app/assets/images/high_five_FINALLL__1_-removebg-preview.png" alt="Company Logo">
                    </div>
                </div>
                <div class="col-md-6 col-12 text-end"> <!-- Use col-md-6 to ensure stacking on smaller screens -->
                    <h2 class="text-primary">INVOICE</h2>
                    <p class="mb-1"><strong>INVOICE NO:</strong> {{invoice_data.invoice_number}}</p>
                    <p class="mb-1"><strong>INVOICE DATE:</strong> {{invoice_data.invoice_date}}</p>
                    <p class="mb-0"><strong>EXPIRY DATE:</strong> {{invoice_data.due_date}}</p>
                </div>
            </div>
            <!-- Customer Info -->
            <div class="row mb-4">
                <div class="col-12"> <!-- Ensure customer info takes full width on all screens -->
                    <h6 class="text-muted">INVOICE TO</h6>
                    <h5>{{invoice_data.customer.name}}</h5>
                    <p class="mb-1">{{invoice_data.customer.email}}</p>
                    <!-- <p class="mb-0"><strong>Phone:</strong> {{invoice_data.customer.phone|default:"N/A"}}</p> -->
                </div>
            </div>
            <!-- Orders Table -->
            <div class="table-responsive mb-4">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>S.NO</th>
                            <th>ORDER NO</th>
                            <th>PO NUMBER</th>
                            <th>DESIGN NAME</th>
                            <th>ORDER DATE</th>
                            <th>TYPE</th>
                            <th class="text-end">PRICE</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in invoice_data.orders %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td>{{order.order_number}}</td>
                            <td>{{order.po_number}}</td>
                            <td>{{order.design_name}}</td>
                            <td>{{order.order_date}}</td>
                            <td>{{order.type}}</td>
                            <td class="text-end">${{order.price|floatformat:2}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Total -->
            <div class="row">
                <div class="col-md-6 col-12"></div> <!-- Use col-md-6 to ensure stacking on smaller screens -->
                <div class="col-md-6 col-12"> <!-- Use col-md-6 to ensure stacking on smaller screens -->
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>Subtotal:</strong></td>
                            <td class="text-end">${{invoice_data.subtotal|floatformat:2}}</td>
                        </tr>
                        {% if invoice_data.tax > 0 %}
                        <tr>
                            <td><strong>Tax:</strong></td>
                            <td class="text-end">${{invoice_data.tax|floatformat:2}}</td>
                        </tr>
                        {% endif %}
                        <tr class="border-top">
                            <td><h5><strong>TOTAL AMOUNT:</strong></h5></td>
                            <td class="text-end"><h5><strong>${{invoice_data.total|floatformat:2}} USD</strong></h5></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
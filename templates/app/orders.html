{% extends "app/base.html" %}
{% block body %}




                <div class="container-fluid">
                    <div class="layout-specing">
                        {% if messages %}
    {% for message in messages|slice:"1" %}
        <div class="message bg-soft-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} text-center p-2">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

                       
                        <div class="d-md-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Orders</h5>

                            <nav aria-label="breadcrumb" class="d-inline-block">
                                <ul class="breadcrumb bg-transparent rounded mb-0 p-0">
                                    <li class="breadcrumb-item text-capitalize"><a href="/">High Five Digitizing</a></li>
                                    <li class="breadcrumb-item text-capitalize"><a href="/orders/">Orders</a></li>
                                    {% comment %} <li class="breadcrumb-item text-capitalize active" aria-current="page">List</li> {% endcomment %}
                                </ul>
                            </nav>
                        </div>

                        <div class="row">
                            <div class="col-12 mt-4">
                                <div class="table-responsive shadow rounded">
                                    {% if orders %}
                                    <table class="table table-center bg-white mb-0">
                                        <thead>
                                            <tr>
                                                <th class="border-bottom p-3">Job ID.</th>
                                                <th class="border-bottom p-3" >Date</th>
                                                <th class="text-center border-bottom p-3" style="min-width: 220px;">Design Name</th>
                                                <th class="text-center border-bottom p-3" style="min-width: 150px;">Stitches</th>
                                                <th class="text-center border-bottom p-3">Status</th>
                                                <th class="text-center border-bottom p-3" style="min-width: 220px;">Type</th>
                                                <th class="text-center border-bottom p-3">Amount</th>
                                                <th class="text-center border-bottom p-3">Download</th>
                                                <th class="text-end border-bottom p-3" style="min-width: 100px;">Preview</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Start -->
                                            {% for order in orders %}
<tr class="text-center">
    <th class="p-3">{{ order.order_id }}</th>
    
    <td class="p-3">
        {{ order.created_at|date:"d/m/Y" }}
    </td>
    
    <td class="text-center p-3">
        {{ order.design_name }}
    </td>
    <td class="text-center p-3">
        {% if order.stitches %}
        {{ order.stitches }} <!-- Placeholder if you have a tracking number -->
        {% else %}
        Unspecified
        {% endif %}
    </td>
    
    <td class="text-center p-3">
        {% if order.payment_status == "Pending Payment" %}
        <div class="badge bg-soft-danger rounded px-3 py-1">
            {{ order.payment_status }}
        </div>
        {% else %}
        <div class="badge bg-soft-success rounded px-3 py-1">
            {{ order.payment_status }}
        </div>
        {% endif %}
    </td>
    
    <td>
        {{ order.type }} 
    </td>
    
    <td>
        ${{order.amount}} <!-- You can show price here if it's available -->
    </td>
    
    <td>
        {% if order.amount > 0 %}
                {% if order.payment_status == "Pending Payment" %}
                <div class="badge bg-soft-info rounded px-3 py-1">
                        <a href="/order_preview/{{order.id}}?type={{order.type}}" class="no_border">
                            
                            Pay and Download
                        </a>
                    </div>
                {% elif order.payment_status == "Success Payment" %}
                <div class="badge bg-soft-success rounded px-3 py-1">
                    <a href="javascript:void(0);" onclick="showDownloadOptions({{ order.id }})" class="no_border">
                        Download
                    </a>
                
                    <div id="downloadModal_{{ order.id }}" class="modal-overlay" style="display:none;">
                        <div class="modal-content">
                            <span class="close-button" onclick="closeDownloadOptions({{ order.id }})">&times;</span>
                            <h2>Choose Download Option</h2>
                            <a href="/media/{{ order.stitched_image }}" download="" class="btn btn-primary mb-3">Download Original ZIP File</a>
                            <button class="btn btn-primary downloadExtractedBtn"
                                data-id="{{ order.id }}" 
                                data-type="{{ order.type }}">
                                Download Extracted Files <br><small class="text-white">(will be downloaded one by one)</small>
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% else %}
            <div class="badge bg-soft-danger rounded px-3 py-1">

                In Process
            </div>
        {% endif %}
    </td>
    
    <td class="text-end p-3">
        <a href="/order_preview/{{order.id}}?type={{order.type}}" class="btn btn-sm btn-primary">Preview</a>
    </td>
</tr>
{% endfor %}

                                            {% comment %} <tr class="text-center">
                                                <th class="p-3">185487</th>
                                                <td class="p-3">
                                                    08/03/2025	
                                                    <!-- <a href="index-dark.html#" class="text-primary">
                                                        <div class="d-flex align-items-center">
                                                            <img src="/static/app/assets/images/client/01.jpg" class="avatar avatar-ex-small rounded-circle shadow" alt="">
                                                            <span class="ms-2">Howard Tanner</span>
                                                        </div>
                                                    </a> -->
                                                </td>
                                                <td class="text-center p-3">Devil-Wallpaper-Image</td>
                                                <td class="text-center p-3">3728</td>
                                                <td class="text-center p-3">
                                                    <div class="badge bg-soft-danger rounded px-3 py-1">
                                                        Pending Payment
                                                    </div>
                                                </td>
                                                <td>Vector Conversion	</td>
                                                <td>$45	</td>
                                                <td>
                                                    <div class="badge bg-soft-danger rounded px-3 py-1">
                                                        Pay and Download
                                                    </div>
                                                </td>
                                                <td class="text-end p-3">
                                                    <a href="#" class="btn btn-sm btn-primary">Preview</a>
                                                </td>
                                            </tr>
                                            <tr class="text-center">
                                                <th class="p-3">185487</th>
                                                <td class="p-3">
                                                    08/03/2025	
                                                    <!-- <a href="index-dark.html#" class="text-primary">
                                                        <div class="d-flex align-items-center">
                                                            <img src="/static/app/assets/images/client/01.jpg" class="avatar avatar-ex-small rounded-circle shadow" alt="">
                                                            <span class="ms-2">Howard Tanner</span>
                                                        </div>
                                                    </a> -->
                                                </td>
                                                <td class="text-center p-3">Devil-Wallpaper-Image</td>
                                                <td class="text-center p-3">3728</td>
                                                <td class="text-center p-3">
                                                    <div class="badge bg-soft-success rounded px-3 py-1">
                                                        Success Payment
                                                    </div>
                                                </td>
                                                <td>Vector Conversion	</td>
                                                <td>$45	</td>
                                                <td>
                                                    <div class="badge bg-soft-danger rounded px-3 py-1">
                                                        Pay and Download
                                                    </div>
                                                </td>
                                                <td class="text-end p-3">
                                                    <a href="#" class="btn btn-sm btn-primary">Preview</a>
                                                </td>
                                            </tr>
                                            <tr class="text-center">
                                                <th class="p-3">185487</th>
                                                <td class="p-3">
                                                    08/03/2025	
                                                    <!-- <a href="index-dark.html#" class="text-primary">
                                                        <div class="d-flex align-items-center">
                                                            <img src="/static/app/assets/images/client/01.jpg" class="avatar avatar-ex-small rounded-circle shadow" alt="">
                                                            <span class="ms-2">Howard Tanner</span>
                                                        </div>
                                                    </a> -->
                                                </td>
                                                <td class="text-center p-3">Devil-Wallpaper-Image</td>
                                                <td class="text-center p-3">3728</td>
                                                <td class="text-center p-3">
                                                    <div class="badge bg-soft-danger rounded px-3 py-1">
                                                        Pending Payment
                                                    </div>
                                                </td>
                                                <td>Vector Conversion	</td>
                                                <td>$45	</td>
                                                <td>
                                                    <div class="badge bg-soft-danger rounded px-3 py-1">
                                                        Pay and Download
                                                    </div>
                                                </td>
                                                <td class="text-end p-3">
                                                    <a href="#" class="btn btn-sm btn-primary">Preview</a>
                                                </td>
                                            </tr> {% endcomment %}
                                            <!-- End -->

                                            <!-- Start -->
                                            
                                            <!-- End -->

                                            
                                            <!-- End -->
                                        </tbody>
                                    </table>
                                    {% else %}
                        <!-- <div class="badge badge-outline-success">
                            You have not Placed any order
                        </div> -->
                        <div class="alert bg-soft-info fw-medium mx-3 my-3" role="alert">You have not Placed any Orders yet <a href="/place_order/" class="text-warning text-decoration-underline">Place Order</a></div>
                        {% endif %}
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->

                        <div class="row text-center">
                            <!-- PAGINATION START -->
                            <div class="col-12 mt-4">
                                <div class="d-md-flex align-items-center text-center justify-content-between">
                                    <span class="text-muted me-3">
                                        Showing {{ orders.start_index }} - {{ orders.end_index }} out of {{ orders.paginator.count }}
                                    </span>
                                    <ul class="pagination mb-0 justify-content-center mt-4 mt-sm-0">
                                        {% if orders.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ orders.previous_page_number }}" aria-label="Previous">Prev</a>
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <span class="page-link">Prev</span>
                                            </li>
                                        {% endif %}
                            
                                        {% for num in orders.paginator.page_range %}
                                            {% if orders.number == num %}
                                                <li class="page-item active">
                                                    <a class="page-link" href="#">{{ num }}</a>
                                                </li>
                                            {% else %}
                                                <li class="page-item">
                                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                            
                                        {% if orders.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ orders.next_page_number }}" aria-label="Next">Next</a>
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <span class="page-link">Next</span>
                                            </li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                            <!--end col-->
                            <!-- PAGINATION END -->
                        </div><!--end row-->
                    </div>
                </div><!--end container-->

                <script>
                    function showDownloadOptions(orderId) {
                        document.getElementById('downloadModal_' + orderId).style.display = 'flex';
                    }
                    
                    function closeDownloadOptions(orderId) {
                        document.getElementById('downloadModal_' + orderId).style.display = 'none';
                    }
                    
                    // Wait for DOM to load
                    document.addEventListener("DOMContentLoaded", function () {
                        const buttons = document.querySelectorAll(".downloadExtractedBtn");
                    
                        buttons.forEach(button => {
                            button.addEventListener("click", function () {
                                const orderId = this.getAttribute('data-id');
                                const orderType = this.getAttribute('data-type');
                    
                                fetch(`/prepare-extracted-files/${orderId}?type=${orderType}`)
                                    .then(res => res.json())
                                    .then(data => {
                                        if (data.files) {
                                            data.files.forEach((url, index) => {
                                                const a = document.createElement("a");
                                                a.href = url;
                                                a.download = "";
                                                a.style.display = "none";
                                                document.body.appendChild(a);
                                                setTimeout(() => {
                                                    a.click();
                                                    document.body.removeChild(a);
                                                }, index * 500);
                                            });
                                        } else {
                                            alert("No files to download.");
                                        }
                    
                                        closeDownloadOptions(orderId);
                                    })
                                    .catch(() => {
                                        alert("Error while downloading.");
                                        closeDownloadOptions(orderId);
                                    });
                            });
                        });
                    });
                    </script>

             
{% endblock body %}
`
        <!-- page-wrapper -->

        <!-- Offcanvas Start -->
        <div class="offcanvas offcanvas-end shadow" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header p-4 border-bottom">
                <h5 id="offcanvasLeftLabel" class="mb-0">
                    <img src="/static/app/assets/images/high_five_FINALLL__1_-removebg-preview.png" height="24" class="light-version" alt="">
                    <img src="/static/app/assets/images/logo-light.png" height="24" class="dark-version" alt="">
                </h5>
                <button type="button" class="btn-close d-flex align-items-center text-dark" data-bs-dismiss="offcanvas" aria-label="Close"><i class="uil uil-times fs-4"></i></button>
            </div>
            <div class="offcanvas-body p-4">
                <div class="row">
                    <div class="col-12">
                        <div class="text-center">
                            <h6 class="fw-bold">Theme Options</h6>

                            <ul class="text-center style-switcher list-unstyled mt-4">
                                <li class="d-grid"><a href="javascript:void(0)" class="rtl-version t-rtl-light" onclick="setTheme('style-rtl')"><img src="/static/app/assets/images/demos/rtl.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">RTL Version</span></a></li>
                                <li class="d-grid"><a href="javascript:void(0)" class="ltr-version t-ltr-light" onclick="setTheme('style')"><img src="/static/app/assets/images/demos/ltr.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">LTR Version</span></a></li>
                                <li class="d-grid"><a href="javascript:void(0)" class="dark-rtl-version t-rtl-dark" onclick="setTheme('style-dark-rtl')"><img src="/static/app/assets/images/demos/dark-rtl.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">RTL Version</span></a></li>
                                <li class="d-grid"><a href="javascript:void(0)" class="dark-ltr-version t-ltr-dark" onclick="setTheme('style-dark')"><img src="/static/app/assets/images/demos/dark.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">LTR Version</span></a></li>
                                <li class="d-grid"><a href="javascript:void(0)" class="dark-version t-dark mt-4" onclick="setTheme('style-dark')"><img src="/static/app/assets/images/demos/dark.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">Dark Version</span></a></li>
                                <li class="d-grid"><a href="javascript:void(0)" class="light-version t-light mt-4" onclick="setTheme('style')"><img src="/static/app/assets/images/demos/ltr.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">Light Version</span></a></li>
                                <li class="d-grid"><a href="https://shreethemes.in/landrick/landing/index.html" target="_blank" class="mt-4"><img src="/static/app/assets/images/demos/landing.png" class="img-fluid rounded-md shadow-md d-block mx-auto" style="width: 230px;" alt=""><span class="text-dark fw-medium mt-3 d-block">Landing</span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="offcanvas-footer p-4 border-top text-center">
                <ul class="list-unstyled social-icon social mb-0">
                    <li class="list-inline-item mb-0"><a href="https://1.envato.market/landrick" target="_blank" class="rounded"><i class="uil uil-shopping-cart align-middle" title="Buy Now"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://dribbble.com/shreethemes" target="_blank" class="rounded"><i class="uil uil-dribbble align-middle" title="dribbble"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://www.behance.net/shreethemes" target="_blank" class="rounded"><i class="uil uil-behance align-middle" title="behance"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://www.facebook.com/shreethemes" target="_blank" class="rounded"><i class="uil uil-facebook-f align-middle" title="facebook"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://www.instagram.com/shreethemes/" target="_blank" class="rounded"><i class="uil uil-instagram align-middle" title="instagram"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://twitter.com/shreethemes" target="_blank" class="rounded"><i class="uil uil-twitter align-middle" title="twitter"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="mailto:support@shreethemes.in" class="rounded"><i class="uil uil-envelope align-middle" title="email"></i></a></li>
                    <li class="list-inline-item mb-0"><a href="https://shreethemes.in" target="_blank" class="rounded"><i class="uil uil-globe align-middle" title="website"></i></a></li>
                </ul><!--end icon-->
            </div>
        </div>
        <!-- Offcanvas End -->
        
        <!-- javascript -->
        <!-- JAVASCRIPT -->
        <script src="/static/app/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/static/app/assets/libs/feather-icons/feather.min.js"></script>
        <script src="/static/app/assets/libs/simplebar/simplebar.min.js"></script>
        <!-- Main Js -->
        <script src="/static/app/assets/js/plugins.init.js"></script>
        <script src="/static/app/assets/js/app.js"></script>
        
    </body>

</html>